<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Nexus | Super Admin</title>
    <script src="https://cdn.ably.com/lib/ably.min-1.js"></script>
    <style>
        :root { --bg: #050505; --accent: #00A2FF; --panel: #0d0d0d; --border: rgba(255,255,255,0.1); }
        body { background: var(--bg); color: white; font-family: 'Plus Jakarta Sans', sans-serif; margin: 0; display: flex; height: 100vh; }
        .sidebar { width: 250px; background: var(--panel); padding: 20px; border-right: 1px solid var(--border); }
        .main { flex: 1; padding: 40px; overflow-y: auto; display: none; } /* Hidden until login */
        .card { background: var(--panel); border: 1px solid var(--border); padding: 20px; border-radius: 12px; margin-bottom: 20px; }
        input { width: 100%; padding: 12px; margin: 10px 0; background: #000; border: 1px solid #333; color: #fff; border-radius: 8px; box-sizing: border-box; }
        .btn { background: var(--accent); color: #000; border: none; padding: 12px; width: 100%; cursor: pointer; font-weight: 800; border-radius: 8px; transition: 0.2s; }
        .btn:hover { opacity: 0.8; }
        .item-row { display: flex; justify-content: space-between; background: #000; padding: 12px; margin-top: 8px; border-radius: 8px; border: 1px solid var(--border); align-items: center; }
        .delete-btn { color: #ff4444; cursor: pointer; border: 1px solid #ff4444; background: none; padding: 4px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: bold; }
        
        /* Login Styles */
        #admin-auth { position: fixed; inset: 0; background: #000; display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .auth-card { background: var(--panel); padding: 30px; border-radius: 15px; border: 1px solid var(--border); width: 300px; text-align: center; }
    </style>
</head>
<body>

    <div id="admin-auth">
        <div class="auth-card">
            <h2 style="color:var(--accent)">NEXUS AUTH</h2>
            <input type="password" id="master-pass" placeholder="Master Passcode">
            <button class="btn" onclick="checkAuth()">UNLOCK SYSTEM</button>
        </div>
    </div>

    <div class="sidebar">
        <h2 style="letter-spacing: -1px;">NEXUS<span style="color:var(--accent)">_</span>OS</h2>
        <p style="font-size: 0.6rem; color: #555; font-weight: 800; text-transform: uppercase;">v3.0 GLOBAL CONTROL</p>
        <hr style="border:0; border-top:1px solid var(--border); margin: 20px 0;">
        <button class="btn" onclick="location.href='threads.html'" style="background:#111; color:#fff; border: 1px solid var(--border);">VIEW FEED</button>
        <button class="btn" onclick="logout()" style="background:transparent; color:#ff4444; margin-top:10px;">LOGOUT</button>
    </div>

    <div class="main" id="admin-content">
        <div class="card">
            <h3>Manage Site Staff (Devs)</h3>
            <div id="staff-list"></div>
            <div style="margin-top:20px;">
                <input type="text" id="sName" placeholder="Developer Name">
                <input type="text" id="sRole" placeholder="Role (e.g. Lead Programmer)">
                <input type="text" id="sImg" placeholder="Profile Image URL">
                <button class="btn" onclick="syncData('nexus_staff', {name: sName.value, role: sRole.value, img: sImg.value})">ADD TO SYSTEM</button>
            </div>
        </div>

        <div class="card">
            <h3>Manage Gallery (Vids)</h3>
            <div id="gallery-list"></div>
            <div style="margin-top:20px;">
                <input type="text" id="gTitle" placeholder="Project Title">
                <input type="text" id="gDesc" placeholder="Short Description">
                <input type="text" id="gVid" placeholder="Video URL (Direct MP4)">
                <button class="btn" onclick="syncData('nexus_gallery', {title: gTitle.value, desc: gDesc.value, vid: gVid.value})">ADD TO GALLERY</button>
            </div>
        </div>

        <div class="card" style="border-color: #ff4444;">
            <h3 style="color:#ff4444;">Danger Zone</h3>
            <button class="btn" style="background:#ff4444;" onclick="clearAllData()">WIPE ALL SITE DATA</button>
        </div>
    </div>

    <script>
        // Connect to Ably
        const ably = new Ably.Realtime('I2GocA.2XM7TQ:nuJQeyu7st5NRAjpGZKS00fjwc4qbCRGioyS_ERGTdc');
        const syncChannel = ably.channels.get('site-global-config');

        // 1. Auth Logic
        function checkAuth() {
            const pass = document.getElementById('master-pass').value;
            if(pass === "adiyan2026") { // Set your password here
                localStorage.setItem('is_super_admin', 'true');
                document.getElementById('admin-auth').style.display = 'none';
                document.getElementById('admin-content').style.display = 'block';
                loadAndRender();
            } else {
                alert("ACCESS DENIED");
            }
        }

        if(localStorage.getItem('is_super_admin') === 'true') {
            document.getElementById('admin-auth').style.display = 'none';
            document.getElementById('admin-content').style.display = 'block';
            loadAndRender();
        }

        // 2. Data Syncing (Sends to everyone)
        function syncData(key, payload) {
            // Basic validation
            if(!payload[Object.keys(payload)[0]]) return alert("Please fill the fields");

            let currentData = JSON.parse(localStorage.getItem(key)) || [];
            currentData.push(payload);
            
            // Save locally and broadcast to all users via Ably
            localStorage.setItem(key, JSON.stringify(currentData));
            syncChannel.publish('site_update', { key: key, data: currentData });
            
            renderAll();
            alert("Data synced to global servers!");
        }

        // 3. Rendering
        function renderAll() {
            renderList('nexus_staff', 'staff-list', (s) => `<b>${s.name}</b> - ${s.role}`);
            renderList('nexus_gallery', 'gallery-list', (g) => `<b>${g.title}</b>`);
        }

        function renderList(key, elementId, labelFn) {
            const data = JSON.parse(localStorage.getItem(key)) || [];
            document.getElementById(elementId).innerHTML = data.map((item, i) => `
                <div class="item-row">
                    <span>${labelFn(item)}</span>
                    <button class="delete-btn" onclick="deleteItem('${key}', ${i})">REMOVE</button>
                </div>
            `).join('');
        }

        function deleteItem(key, index) {
            let data = JSON.parse(localStorage.getItem(key));
            data.splice(index, 1);
            localStorage.setItem(key, JSON.stringify(data));
            syncChannel.publish('site_update', { key: key, data: data });
            renderAll();
        }

        async function loadAndRender() {
            // Get the latest data from history if local is empty
            syncChannel.history({limit: 1}, (err, page) => {
                if(!err && page.items.length > 0) {
                    const latest = page.items[0].data;
                    localStorage.setItem(latest.key, JSON.stringify(latest.data));
                }
                renderAll();
            });
        }

        function logout() {
            localStorage.removeItem('is_super_admin');
            location.reload();
        }

        function clearAllData() {
            if(confirm("This will delete EVERYTHING for EVERYONE. Continue?")) {
                localStorage.clear();
                syncChannel.publish('site_update', { key: 'nexus_staff', data: [] });
                syncChannel.publish('site_update', { key: 'nexus_gallery', data: [] });
                location.reload();
            }
        }
    </script>
</body>
</html>
