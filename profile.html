<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Profile // Nexus</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;800&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #030303; --accent: #00A2FF; --border: #1a1a1a; }
        body { background: var(--bg); color: #fff; font-family: 'Plus Jakarta Sans', sans-serif; margin: 0; display: flex; justify-content: center; }
        .wrapper { width: 600px; border-left: 1px solid var(--border); border-right: 1px solid var(--border); min-height: 100vh; }
        .banner { height: 160px; background: #111; border-bottom: 1px solid var(--border); }
        .pfp-row { padding: 0 20px; display: flex; justify-content: space-between; align-items: flex-end; margin-top: -50px; }
        .pfp { width: 110px; height: 110px; border-radius: 10px; border: 4px solid #000; background: #111; object-fit: cover; }
        .btn { background: transparent; border: 1px solid #333; color: #fff; padding: 8px 16px; border-radius: 20px; font-weight: 800; cursor: pointer; margin-bottom: 10px; }
        .content { padding: 20px; }
        .name { font-size: 1.6rem; font-weight: 800; margin: 0; }
        .bio { margin-top: 10px; color: #888; }
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); align-items: center; justify-content: center; z-index: 100; }
        .modal-box { background: #0a0a0a; padding: 25px; border-radius: 12px; width: 320px; border: 1px solid var(--border); }
        input, textarea { width: 100%; background: #000; border: 1px solid var(--border); color: #fff; padding: 10px; margin-top: 10px; border-radius: 6px; box-sizing: border-box; }
        .save-btn { background: var(--accent); color: #000; width: 100%; border: none; padding: 10px; border-radius: 6px; font-weight: 800; margin-top: 15px; cursor: pointer; }
    </style>
</head>
<body>
    <div class="wrapper">
        <div id="banner-ui" class="banner"></div>
        <div class="pfp-row">
            <img id="pfp-ui" class="pfp" src="">
            <div id="btn-slot"></div>
        </div>
        <div class="content">
            <h1 id="name-ui" class="name">Loading...</h1>
            <p id="bio-ui" class="bio">No bio yet.</p>
            <div style="margin-top:20px; padding-top:20px; border-top:1px solid var(--border); color:#444; font-size:0.8rem; font-weight:800;">POSTS</div>
        </div>
    </div>

    <div id="edit-modal" class="modal">
        <div class="modal-box">
            <h3 style="margin:0;">Edit Profile</h3>
            <input type="text" id="edit-pfp" placeholder="Custom PFP URL (Imgur/Discord)">
            <input type="color" id="edit-color" title="Banner Color">
            <textarea id="edit-bio" placeholder="Write something about yourself..."></textarea>
            <button class="save-btn" onclick="save()">Save Changes</button>
            <button onclick="closeModal()" style="background:none; border:none; color:#555; width:100%; margin-top:10px; cursor:pointer;">Cancel</button>
        </div>
    </div>

    <script>
        const params = new URLSearchParams(window.location.search);
        const user = params.get('user');
        const me = localStorage.getItem('rbx_user');

        window.onload = async () => {
            if(!user) return;
            document.getElementById('name-ui').innerText = user;
            
            if(user === me) {
                document.getElementById('btn-slot').innerHTML = `<button class="btn" onclick="openModal()">Edit Profile</button>`;
            }

            // LOAD SAVED DATA
            const savedBio = localStorage.getItem(`bio_${user}`);
            const savedColor = localStorage.getItem(`color_${user}`);
            const savedPfp = localStorage.getItem(`pfp_${user}`);

            if(savedBio) document.getElementById('bio-ui').innerText = savedBio;
            if(savedColor) document.getElementById('banner-ui').style.background = savedColor;
            
            if(savedPfp) {
                document.getElementById('pfp-ui').src = savedPfp;
            } else {
                // Fetch Roblox PFP if no custom one
                const s = await fetch(`https://users.roproxy.com/v1/users/search?keyword=${user}&limit=1`);
                const sd = await s.json();
                const t = await fetch(`https://thumbnails.roproxy.com/v1/users/avatar-headshot?userIds=${sd.data[0].id}&size=150x150&format=Png&isCircular=false`);
                const td = await t.json();
                document.getElementById('pfp-ui').src = td.data[0].imageUrl;
            }
        };

        function openModal() { document.getElementById('edit-modal').style.display='flex'; }
        function closeModal() { document.getElementById('edit-modal').style.display='none'; }
        
        function save() {
            localStorage.setItem(`bio_${me}`, document.getElementById('edit-bio').value);
            localStorage.setItem(`color_${me}`, document.getElementById('edit-color').value);
            const customPfp = document.getElementById('edit-pfp').value;
            if(customPfp) localStorage.setItem(`pfp_${me}`, customPfp);
            location.reload();
        }
    </script>
</body>
</html>
