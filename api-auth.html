<!DOCTYPE html>
<html>
<head>
    <title>Nexus Auth Processing...</title>
    <script src="https://cdn.ably.com/lib/ably.min-1.js"></script>
</head>
<body style="background:#000; color:#fff; font-family:sans-serif; display:flex; align-items:center; justify-content:center; height:100vh;">
    <div style="text-align:center;">
        <h2>Connecting to Roblox...</h2>
        <p id="status">Verifying Session</p>
    </div>

    <script>
        async function processAuth() {
            // Replace with your actual Roblox Client ID from the Dashboard
            const clientId = "4112872619143689543"; 
            const redirectUri = encodeURIComponent(window.location.origin + window.location.pathname);
            
            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get('code');

            if (!code) {
                // Step 1: Send user to Roblox
                window.location.href = `https://apis.roblox.com/oauth/v1/authorize?client_id=${clientId}&redirect_uri=${redirectUri}&scope=openid%20profile&response_type=code`;
            } else {
                // Step 2: User is back from Roblox. 
                // Normally we exchange 'code' for a token here. 
                // Since we are on GitHub, we'll use a prompt to "Verify" the identity for the session.
                document.getElementById('status').innerText = "Linking Account...";
                
                const username = prompt("Verify your Roblox Username to complete the link:");
                if(username) {
                    const s = await fetch(`https://users.roproxy.com/v1/users/search?keyword=${username}&limit=1`);
                    const sd = await s.json();
                    const t = await fetch(`https://thumbnails.roproxy.com/v1/users/avatar-headshot?userIds=${sd.data[0].id}&size=150x150&format=Png`);
                    const td = await t.json();

                    // Send back to the feed with the data
                    window.location.href = `threads.html?username=${sd.data[0].name}&thumbnail=${td.data[0].imageUrl}`;
                }
            }
        }
        processAuth();
    </script>
</body>
</html>
